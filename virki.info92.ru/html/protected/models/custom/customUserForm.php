<? /******************************************************************************************************************* * This file is the part of VPlatform project https://info92.ru * Copyright (C) 2013-2020, info92 team * All rights reserved and protected by law. * You can't use this file without of the author's permission. * ==================================================================================================================== * <description file="UserForm.php"> * </description> **********************************************************************************************************************/ ?><?php/* * Класс для нормального отображения и валидации форм авторизации и регистрации * @package User */class customUserForm extends CFormModel{    /*     * Пароль пользователя     * @var string     */    public $captcha;    /*     * Метка для запоминания авторизации     * @var boolean;     */    public $default_manager;    /*     * Имя     * @var string     */    public $doGo;    public $email;    public $fullname;    public $password;    public $password2;    public $phone;    public $privacy;    public $rememberMe = false;    function attributeLabels()    {        return [          'fullname'        => Yii::t('main', 'Фамилия Имя Отчество'),          'default_manager' => Yii::t('main', 'Промо-код'),          'password'        => Yii::t('main', 'Пароль'),          'password2'       => Yii::t('main', 'Повторите пароль'),          'email'           => 'EMail',          'rememberMe'      => Yii::t('main', 'Запомнить меня'),          'captcha'         => Yii::t('main', 'Значение, или результат выражения на картинке'),          'phone'           => Yii::t('main', 'Телефон'),        ];    }    function rules()    {        $result = [];        $loginByPhone = (boolean) DSConfig::getVal('login_use_phone_as_login');        if (!$loginByPhone) {            $result[] = ['fullname,password,email,password2,privacy', 'required', 'on' => 'register'];            $result[] = ['email, password', 'required', 'on' => 'login'];            $result[] = ['doGo', 'safe', 'on' => 'login'];            $result[] = ['fullname', 'length', 'min' => 1, 'max' => 512];            $result[] = ['password', 'length', 'min' => 4, 'max' => 64];            $result[] = ['password', 'compare', 'compareAttribute' => 'password2', 'on' => 'register'];            $result[] = ['password', 'compare', 'compareAttribute' => 'password2', 'on' => 'password_reset'];            $result[] = ['password,password2', 'required', 'on' => 'password_reset'];            $result[] = ['rememberMe,privacy', 'boolean'];            $result[] = ['phone', 'length', 'min' => 6, 'max' => 12];            $result[] =              ['email', 'email', 'allowName' => false, 'pattern' => '/[a-z0-9\-\.\+%_]+@[a-z0-9\.\-]+\.[a-z]{2,6}/i'];            $result[] = ['default_manager', 'safe'];            $result[] = [              'captcha',              'captcha',              'allowEmpty'    => !CCaptcha::checkRequirements(),              'captchaAction' => 'user/captcha',              'on'            => 'register',            ];        } else {            $result[] = ['phone,password,password2,privacy', 'required', 'on' => 'register'];            $result[] = ['phone, password,', 'required', 'on' => 'login'];            $result[] = ['doGo', 'safe', 'on' => 'login'];            $result[] = ['password', 'length', 'min' => 4, 'max' => 64];            $result[] = ['password', 'compare', 'compareAttribute' => 'password2', 'on' => 'register'];            $result[] = ['password', 'compare', 'compareAttribute' => 'password2', 'on' => 'password_reset'];            $result[] = ['password,password2', 'required', 'on' => 'password_reset'];            $result[] = ['rememberMe, privacy', 'boolean'];            //$result[] = array('phone', 'length', 'min' => 6, 'max' => 12);            $result[] = [              'email',              'email',              'allowName' => false,              'pattern'   => '/(?:[a-z0-9\-\.\+%_]+@[a-z0-9\.\-]+\.[a-z]{2,6})|(?:[\+]{0,1}\d{11,13})/i',            ];            $result[] = ['email,default_manager', 'safe'];            $result[] = [              'captcha',              'captcha',              'allowEmpty'    => !CCaptcha::checkRequirements(),              'captchaAction' => 'user/captcha',              'on'            => 'register',            ];        }        return $result;    }}