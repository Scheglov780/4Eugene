(function(){var a={},s={},l={},u=window.document,m=window.RegExp,g=window.navigator,o={lineLength:72},t={isIE:/msie/.test(g.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(g.userAgent.toLowerCase())||/msie 5/.test(g.userAgent.toLowerCase()),isOpera:/opera/.test(g.userAgent.toLowerCase())};var v='<p>http://example.com/ "optional title"</p>';var p='<p>http://example.com/images/diagram.jpg "optional title"</p>';var c="http://";var d="http://";var j="Markdown Editing Help";Markdown.Editor=function(z,x,C,B){if(typeof(C)==="object"){B=C;C=null}C=C||"";x=x||"wmd-input";var w=this.hooks=new Markdown.HookCollection();w.addNoop("onPreviewRefresh");w.addNoop("postBlockquoteCreation");w.addFalse("insertImageDialog");this.getConverter=function(){return z};var A=this,y;this.run=function(){if(y){return}y=new i(x,C);var F=new k(w);var D=new h(z,y,function(){w.onPreviewRefresh()});var G,E;if(!/\?noundo/.test(u.location.href)){G=new e(function(){D.refresh();if(E){E.setUndoRedoButtonStates()}},y);this.textOperation=function(I){G.setCommandMode();I();A.refreshPreview()}}E=new q(C,y,G,D,F,B);E.setUndoRedoButtonStates();var H=A.refreshPreview=function(){D.refresh(true)};H()}};function r(){}r.prototype.findTags=function(x,z){var w=this;var y;if(x){y=a.extendRegExp(x,"","$");this.before=this.before.replace(y,function(A){w.startTag=w.startTag+A;return""});y=a.extendRegExp(x,"^","");this.selection=this.selection.replace(y,function(A){w.startTag=w.startTag+A;return""})}if(z){y=a.extendRegExp(z,"","$");this.selection=this.selection.replace(y,function(A){w.endTag=A+w.endTag;return""});y=a.extendRegExp(z,"^","");this.after=this.after.replace(y,function(A){w.endTag=A+w.endTag;return""})}};r.prototype.trimWhitespace=function(x){var w,z,y=this;if(x){w=z=""}else{w=function(A){y.before+=A;return""};z=function(A){y.after=A+y.after;return""}}this.selection=this.selection.replace(/^(\s*)/,w).replace(/(\s*)$/,z)};r.prototype.skipLines=function(y,x,w){if(y===undefined){y=1}if(x===undefined){x=1}y++;x++;var z;var A;if(navigator.userAgent.match(/Chrome/)){"X".match(/()./)}this.selection=this.selection.replace(/(^\n*)/,"");this.startTag=this.startTag+m.$1;this.selection=this.selection.replace(/(\n*$)/,"");this.endTag=this.endTag+m.$1;this.startTag=this.startTag.replace(/(^\n*)/,"");this.before=this.before+m.$1;this.endTag=this.endTag.replace(/(\n*$)/,"");this.after=this.after+m.$1;if(this.before){z=A="";while(y--){z+="\\n?";A+="\n"}if(w){z="\\n*"}this.before=this.before.replace(new m(z+"$",""),A)}if(this.after){z=A="";while(x--){z+="\\n?";A+="\n"}if(w){z="\\n*"}this.after=this.after.replace(new m(z,""),A)}};function i(w,x){this.buttonBar=u.getElementById("wmd-button-bar"+x);this.preview=u.getElementById("wmd-preview"+x);this.input=u.getElementById(w+x)}a.isVisible=function(w){if(window.getComputedStyle){return window.getComputedStyle(w,null).getPropertyValue("display")!=="none"}else{if(w.currentStyle){return w.currentStyle.display!=="none"}}};a.addEvent=function(x,w,y){if(x.attachEvent){x.attachEvent("on"+w,y)}else{x.addEventListener(w,y,false)}};a.removeEvent=function(x,w,y){if(x.detachEvent){x.detachEvent("on"+w,y)}else{x.removeEventListener(w,y,false)}};a.fixEolChars=function(w){w=w.replace(/\r\n/g,"\n");w=w.replace(/\r/g,"\n");return w};a.extendRegExp=function(y,A,x){if(A===null||A===undefined){A=""}if(x===null||x===undefined){x=""}var z=y.toString();var w;z=z.replace(/\/([gim]*)$/,function(B,C){w=C;return""});z=z.replace(/(^\/|\/$)/g,"");z=A+z+x;return new m(z,w)};s.getTop=function(y,x){var w=y.offsetTop;if(!x){while(y=y.offsetParent){w+=y.offsetTop}}return w};s.getHeight=function(w){return w.offsetHeight||w.scrollHeight};s.getWidth=function(w){return w.offsetWidth||w.scrollWidth};s.getPageSize=function(){var x,y;var w,B;if(self.innerHeight&&self.scrollMaxY){x=u.body.scrollWidth;y=self.innerHeight+self.scrollMaxY}else{if(u.body.scrollHeight>u.body.offsetHeight){x=u.body.scrollWidth;y=u.body.scrollHeight}else{x=u.body.offsetWidth;y=u.body.offsetHeight}}if(self.innerHeight){w=self.innerWidth;B=self.innerHeight}else{if(u.documentElement&&u.documentElement.clientHeight){w=u.documentElement.clientWidth;B=u.documentElement.clientHeight}else{if(u.body){w=u.body.clientWidth;B=u.body.clientHeight}}}var A=Math.max(x,w);var z=Math.max(y,B);return[A,z,w,B]};function e(I,F){var L=this;var G=[];var D=0;var C="none";var x;var y;var B;var w=function(N,M){if(C!=N){C=N;if(!M){z()}}if(!t.isIE||C!="moving"){y=setTimeout(E,1)}else{B=null}};var E=function(M){B=new b(F,M);y=undefined};this.setCommandMode=function(){C="command";z();y=setTimeout(E,0)};this.canUndo=function(){return D>1};this.canRedo=function(){if(G[D+1]){return true}return false};this.undo=function(){if(L.canUndo()){if(x){x.restore();x=null}else{G[D]=new b(F);G[--D].restore();if(I){I()}}}C="none";F.input.focus();E()};this.redo=function(){if(L.canRedo()){G[++D].restore();if(I){I()}}C="none";F.input.focus();E()};var z=function(){var M=B||new b(F);if(!M){return false}if(C=="moving"){if(!x){x=M}return}if(x){if(G[D-1].text!=x.text){G[D++]=x}x=null}G[D++]=M;G[D+1]=null;if(I){I()}};var H=function(M){var O=false;if(M.ctrlKey||M.metaKey){var N=M.charCode||M.keyCode;var P=String.fromCharCode(N);switch(P){case"y":L.redo();O=true;break;case"z":if(!M.shiftKey){L.undo()}else{L.redo()}O=true;break}}if(O){if(M.preventDefault){M.preventDefault()}if(window.event){window.event.returnValue=false}return}};var K=function(M){if(!M.ctrlKey&&!M.metaKey){var N=M.keyCode;if((N>=33&&N<=40)||(N>=63232&&N<=63235)){w("moving")}else{if(N==8||N==46||N==127){w("deleting")}else{if(N==13){w("newlines")}else{if(N==27){w("escape")}else{if((N<16||N>20)&&N!=91){w("typing")}}}}}}};var A=function(){a.addEvent(F.input,"keypress",function(N){if((N.ctrlKey||N.metaKey)&&(N.keyCode==89||N.keyCode==90)){N.preventDefault()}});var M=function(){if(t.isIE||(B&&B.text!=F.input.value)){if(y==undefined){C="paste";z();E()}}};a.addEvent(F.input,"keydown",H);a.addEvent(F.input,"keydown",K);a.addEvent(F.input,"mousedown",function(){w("moving")});F.input.onpaste=M;F.input.ondrop=M};var J=function(){A();E(true);z()};J()}function b(x,z){var w=this;var y=x.input;this.init=function(){if(!a.isVisible(y)){return}if(!z&&u.activeElement&&u.activeElement!==y){return}this.setInputAreaSelectionStartEnd();this.scrollTop=y.scrollTop;if(!this.text&&y.selectionStart||y.selectionStart===0){this.text=y.value}};this.setInputAreaSelection=function(){if(!a.isVisible(y)){return}if(y.selectionStart!==undefined&&!t.isOpera){y.focus();y.selectionStart=w.start;y.selectionEnd=w.end;y.scrollTop=w.scrollTop}else{if(u.selection){if(u.activeElement&&u.activeElement!==y){return}y.focus();var A=y.createTextRange();A.moveStart("character",-y.value.length);A.moveEnd("character",-y.value.length);A.moveEnd("character",w.end);A.moveStart("character",w.start);A.select()}}};this.setInputAreaSelectionStartEnd=function(){if(!x.ieCachedRange&&(y.selectionStart||y.selectionStart===0)){w.start=y.selectionStart;w.end=y.selectionEnd}else{if(u.selection){w.text=a.fixEolChars(y.value);var D=x.ieCachedRange||u.selection.createRange();var E=a.fixEolChars(D.text);var C="\x07";var B=C+E+C;D.text=B;var F=a.fixEolChars(y.value);D.moveStart("character",-B.length);D.text=E;w.start=F.indexOf(C);w.end=F.lastIndexOf(C)-C.length;var A=w.text.length-a.fixEolChars(y.value).length;if(A){D.moveStart("character",-E.length);while(A--){E+="\n";w.end+=1}D.text=E}if(x.ieCachedRange){w.scrollTop=x.ieCachedScrollTop}x.ieCachedRange=null;this.setInputAreaSelection()}}};this.restore=function(){if(w.text!=undefined&&w.text!=y.value){y.value=w.text}this.setInputAreaSelection();y.scrollTop=w.scrollTop};this.getChunks=function(){var A=new r();A.before=a.fixEolChars(w.text.substring(0,w.start));A.startTag="";A.selection=a.fixEolChars(w.text.substring(w.start,w.end));A.endTag="";A.after=a.fixEolChars(w.text.substring(w.end));A.scrollTop=w.scrollTop;return A};this.setChunks=function(A){A.before=A.before+A.startTag;A.after=A.endTag+A.after;this.start=A.before.length;this.end=A.before.length+A.selection.length;this.text=A.before+A.selection+A.after;this.scrollTop=A.scrollTop};this.init()}function h(Q,z,K){var x=this;var E;var D;var N;var y=3000;var F="delayed";var B=function(S,T){a.addEvent(S,"input",T);S.onpaste=T;S.ondrop=T;a.addEvent(S,"keypress",T);a.addEvent(S,"keydown",T)};var J=function(){var S=0;if(window.innerHeight){S=window.pageYOffset}else{if(u.documentElement&&u.documentElement.scrollTop){S=u.documentElement.scrollTop}else{if(u.body){S=u.body.scrollTop}}}return S};var C=function(){if(!z.preview){return}var U=z.input.value;if(U&&U==N){return}else{N=U}var T=new Date().getTime();U=Q.makeHtml(U);var S=new Date().getTime();D=S-T;w(U)};var P=function(){if(E){clearTimeout(E);E=undefined}if(F!=="manual"){var S=0;if(F==="delayed"){S=D}if(S>y){S=y}E=setTimeout(C,S)}};var A=function(S){if(S.scrollHeight<=S.clientHeight){return 1}return S.scrollTop/(S.scrollHeight-S.clientHeight)};var R=function(){if(z.preview){z.preview.scrollTop=(z.preview.scrollHeight-z.preview.clientHeight)*A(z.preview)}};this.refresh=function(S){if(S){N="";C()}else{P()}};this.processingTime=function(){return D};var G=true;var H=function(V){var U=z.preview;var T=U.parentNode;var S=U.nextSibling;T.removeChild(U);U.innerHTML=V;if(!S){T.appendChild(U)}else{T.insertBefore(U,S)}};var M=function(S){z.preview.innerHTML=S};var I;var L=function(T){if(I){return I(T)}try{M(T);I=M}catch(S){I=H;I(T)}};var w=function(U){var S=s.getTop(z.input)-J();if(z.preview){L(U);K()}R();if(G){G=false;return}var T=s.getTop(z.input)-J();if(t.isIE){setTimeout(function(){window.scrollBy(0,T-S)},0)}else{window.scrollBy(0,T-S)}};var O=function(){B(z.input,P);C();if(z.preview){z.preview.scrollTop=0}};O()}l.prompt=function(x,B,E,z){var w;var y;if(E===undefined){E=""}var A=function(F){var G=(F.charCode||F.keyCode);if(G===27){C(true)}};var C=function(F){a.removeEvent(u.body,"keydown",A);var G=y.value;if(F){G=null}else{G=G.replace(/^http:\/\/(https?|ftp):\/\//,"$1://");if(!/^(?:https?|ftp):\/\//.test(G)){G="http://"+G}}$(w).modal("hide");z(G);return false};var D=function(){w=u.createElement("div");w.className="modal hide fade";w.style.display="none";var M=u.createElement("div");M.className="modal-header";M.innerHTML='<a class="close" data-dismiss="modal">×</a> <h3>'+x+"</h3>";w.appendChild(M);var F=u.createElement("div");F.className="modal-body";w.appendChild(F);var L=u.createElement("div");L.className="modal-footer";w.appendChild(L);var G=u.createElement("p");G.innerHTML=B;G.style.padding="5px";F.appendChild(G);var I=u.createElement("form"),H=I.style;I.onsubmit=function(){return C(false)};H.padding="0";H.margin="0";F.appendChild(I);y=u.createElement("input");y.type="text";y.value=E;H=y.style;H.display="block";H.width="80%";H.marginLeft=H.marginRight="auto";I.appendChild(y);var K=u.createElement("button");K.className="btn btn-primary";K.type="button";K.onclick=function(){return C(false)};K.innerHTML="OK";var J=u.createElement("button");J.className="btn btn-primary";J.type="button";J.onclick=function(){return C(true)};J.innerHTML="Cancel";L.appendChild(K);L.appendChild(J);a.addEvent(u.body,"keydown",A);u.body.appendChild(w)};setTimeout(function(){D();var G=E.length;if(y.selectionStart!==undefined){y.selectionStart=0;y.selectionEnd=G}else{if(y.createTextRange){var F=y.createTextRange();F.collapse(false);F.moveStart("character",-G);F.moveEnd("character",G);F.select()}}$(w).on("shown",function(){y.focus()});$(w).on("hidden",function(){w.parentNode.removeChild(w)});$(w).modal()},0)};function q(I,D,K,y,H,A){var B=D.input,F={};if(!A){A=Markdown.Editor.getDefaultButtons()}else{if(A.handler){var C=A;A=Markdown.Editor.getDefaultButtons();A.help=Markdown.Editor.getDefaultHelpButton();A.help.handler=C.handler;if(C.title){A.help.title=C.title}}}z();var E="keydown";if(t.isOpera){E="keypress"}a.addEvent(B,E,function(M){if((M.ctrlKey||M.metaKey)&&!M.altKey&&!M.shiftKey){var N=M.charCode||M.keyCode;var L=String.fromCharCode(N).toLowerCase();switch(L){case"b":J(F.bold);break;case"i":J(F.italic);break;case"l":J(F.link);break;case"q":J(F.quote);break;case"k":J(F.code);break;case"g":J(F.image);break;case"o":J(F.olist);break;case"u":J(F.ulist);break;case"h":J(F.heading);break;case"r":J(F.hr);break;case"y":J(F.redo);break;case"z":if(M.shiftKey){J(F.redo)}else{J(F.undo)}break;default:return}if(M.preventDefault){M.preventDefault()}if(window.event){window.event.returnValue=false}}});a.addEvent(B,"keyup",function(M){if(M.shiftKey&&!M.ctrlKey&&!M.metaKey){var N=M.charCode||M.keyCode;if(N===13){var L={};L.textOp=x("doAutoindent");J(L)}}});if(t.isIE){a.addEvent(B,"keydown",function(L){var M=L.keyCode;if(M===27){return false}})}function J(M){if(!M){return}B.focus();if(M.textOp){if(K){K.setCommandMode()}var O=new b(D);if(!O){return}var P=O.getChunks();var L=function(){B.focus();if(P){O.setChunks(P)}O.restore();y.refresh()};var N=M.textOp(P,L);if(!N){L()}}if(M.execute){M.execute(K)}}function w(L,M){if(M){L.disabled=false;if(!L.isHelp){L.onclick=function(){if(this.onmouseout){this.onmouseout()}J(this);return false}}}else{L.disabled=true}}function x(L){if(typeof L==="string"){L=H[L]}return function(){L.apply(H,arguments)}}function z(){var M=D.buttonBar;var O=document.createElement("div");O.id="wmd-button-row"+I;O.className="btn-toolbar";O=M.appendChild(O);var N=function(S,V,U){if(!S){return null}var T=document.createElement("button");T.className="btn";var R=document.createElement("i");R.className=S.icon;T.id=S.id+I;T.appendChild(R);T.title=S.title;$(T).tooltip({placement:"bottom"});if(V){T.textOp=V}w(T,true);if(U){U.appendChild(T)}else{O.appendChild(T)}return T};var P=function(R){var S=document.createElement("div");S.className="btn-group wmd-button-group"+R;S.id="wmd-button-group"+R+I;O.appendChild(S);return S};group1=P(1);F.bold=N(A.bold,x("doBold"),group1);F.italic=N(A.italic,x("doItalic"),group1);group2=P(2);F.link=N(A.link,x(function(R,S){return this.doLinkOrImage(R,S,false)}),group2);F.quote=N(A.quote,x("doBlockquote"),group2);F.code=N(A.code,x("doCode"),group2);F.image=N(A.image,x(function(R,S){return this.doLinkOrImage(R,S,true)}),group2);group3=P(3);F.olist=N(A.olist,x(function(R,S){this.doList(R,S,true)}),group3);F.ulist=N(A.ulist,x(function(R,S){this.doList(R,S,false)}),group3);F.heading=N(A.heading,x("doHeading"),group3);F.hr=N(A.hr,x("doHorizontalRule"),group3);group4=P(4);F.undo=N(A.undo,null,group4);if(F.undo){F.undo.execute=function(R){if(R){R.undo()}}}F.redo=N(A.redo,null,group4);if(F.redo){F.redo.execute=function(R){if(R){R.redo()}}}if(A.help){group5=P(5);group5.className=group5.className+" pull-right";var Q=document.createElement("button");Q.className="btn";Q.id=A.help.id+I;var L=document.createElement("i");L.className="icon-question-sign";Q.appendChild(L);Q.isHelp=true;Q.title=A.help.title;$(Q).tooltip({placement:"bottom"});Q.onclick=A.help.handler;w(Q,true);group5.appendChild(Q);F.help=Q}G()}function G(){if(K){w(F.undo,K.canUndo());w(F.redo,K.canRedo())}}this.setUndoRedoButtonStates=G}function k(w){this.hooks=w}var f=k.prototype;f.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";f.unwrap=function(x){var w=new m("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");x.selection=x.selection.replace(w,"$1 $2")};f.wrap=function(x,w){this.unwrap(x);var z=new m("(.{1,"+w+"})( +|$\\n?)","gm"),y=this;x.selection=x.selection.replace(z,function(A,B){if(new m("^"+y.prefixes,"").test(A)){return A}return B+"\n"});x.selection=x.selection.replace(/\s+$/,"")};f.doBold=function(w,x){return this.doBorI(w,x,2,"strong text")};f.doItalic=function(w,x){return this.doBorI(w,x,1,"emphasized text")};f.doBorI=function(C,A,B,w){C.trimWhitespace();C.selection=C.selection.replace(/\n{2,}/g,"\n");var z=/(\**$)/.exec(C.before)[0];var x=/(^\**)/.exec(C.after)[0];var D=Math.min(z.length,x.length);if((D>=B)&&(D!=2||B!=1)){C.before=C.before.replace(m("[*]{"+B+"}$",""),"");C.after=C.after.replace(m("^[*]{"+B+"}",""),"")}else{if(!C.selection&&x){C.after=C.after.replace(/^([*_]*)/,"");C.before=C.before.replace(/(\s?)$/,"");var y=m.$1;C.before=C.before+x+y}else{if(!C.selection&&!x){C.selection=w}var E=B<=1?"*":"**";C.before=C.before+E;C.after=E+C.after}}return};f.stripLinkDefs=function(x,w){x=x.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(B,C,y,z,A){w[C]=B.replace(/\s*$/,"");if(z){w[C]=B.replace(/["(](.+?)[")]$/,"");return z+A}return""});return x};f.addLinkDef=function(D,z){var w=0;var y={};D.before=this.stripLinkDefs(D.before,y);D.selection=this.stripLinkDefs(D.selection,y);D.after=this.stripLinkDefs(D.after,y);var x="";var C=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g;var B=function(F){w++;F=F.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+w+"]:");x+="\n"+F};var A=function(G,J,H,I,K,F){H=H.replace(C,A);if(y[K]){B(y[K]);return J+H+I+w+F}return G};D.before=D.before.replace(C,A);if(z){B(z)}else{D.selection=D.selection.replace(C,A)}var E=w;D.after=D.after.replace(C,A);if(D.after){D.after=D.after.replace(/\n*$/,"")}if(!D.after){D.selection=D.selection.replace(/\n*$/,"")}D.after+="\n\n"+x;return E};function n(w){return w.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(y,x,z){x=x.replace(/\?.*$/,function(A){return A.replace(/\+/g," ")});x=decodeURIComponent(x);x=encodeURI(x).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29");x=x.replace(/\?.*$/,function(A){return A.replace(/\+/g,"%2b")});if(z){z=z.trim?z.trim():z.replace(/^\s*/,"").replace(/\s*$/,"");z=$.trim(z).replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return z?x+' "'+z+'"':x})}f.doLinkOrImage=function(w,y,B){w.trimWhitespace();w.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);var x;if(w.endTag.length>1&&w.startTag.length>0){w.startTag=w.startTag.replace(/!?\[/,"");w.endTag="";this.addLinkDef(w,null)}else{w.selection=w.startTag+w.selection+w.endTag;w.startTag=w.endTag="";if(/\n\n/.test(w.selection)){this.addLinkDef(w,null);return}var z=this;var A=function(E){if(E!==null){w.selection=(" "+w.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var D=" [999]: "+n(E);var C=z.addLinkDef(w,D);w.startTag=B?"![":"[";w.endTag="]["+C+"]";if(!w.selection){if(B){w.selection="enter image description here"}else{w.selection="enter link description here"}}}y()};if(B){if(!this.hooks.insertImageDialog(A)){l.prompt("Insert Image",p,c,A)}}else{l.prompt("Insert Link",v,d,A)}return true}};f.doAutoindent=function(y,z){var x=this,w=false;y.before=y.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");y.before=y.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");y.before=y.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");if(!y.selection&&!/^[ \t]*(?:\n|$)/.test(y.after)){y.after=y.after.replace(/^[^\n]*/,function(A){y.selection=A;return""});w=true}if(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(y.before)){if(x.doList){x.doList(y)}}if(/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(y.before)){if(x.doBlockquote){x.doBlockquote(y)}}if(/(\n|^)(\t|[ ]{4,}).*\n$/.test(y.before)){if(x.doCode){x.doCode(y)}}if(w){y.after=y.selection+y.after;y.selection=""}};f.doBlockquote=function(D,y){D.selection=D.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(J,I,H,G){D.before+=I;D.after=G+D.after;return H});D.before=D.before.replace(/(>[ \t]*)$/,function(H,G){D.selection=G+D.selection;return""});D.selection=D.selection.replace(/^(\s|>)+$/,"");D.selection=D.selection||"Blockquote";var C="",B="",E;if(D.before){var F=D.before.replace(/\n$/,"").split("\n");var A=false;for(var z=0;z<F.length;z++){var x=false;E=F[z];A=A&&E.length>0;if(/^>/.test(E)){x=true;if(!A&&E.length>1){A=true}}else{if(/^[ \t]*$/.test(E)){x=true}else{x=A}}if(x){C+=E+"\n"}else{B+=C+E;C="\n"}}if(!/(^|\n)>/.test(C)){B+=C;C=""}}D.startTag=C;D.before=B;if(D.after){D.after=D.after.replace(/^\n?/,"\n")}D.after=D.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(G){D.endTag=G;return""});var w=function(H){var G=H?"> ":"";if(D.startTag){D.startTag=D.startTag.replace(/\n((>|\s)*)\n$/,function(J,I){return"\n"+I.replace(/^[ ]{0,3}>?[ \t]*$/gm,G)+"\n"})}if(D.endTag){D.endTag=D.endTag.replace(/^\n((>|\s)*)\n/,function(J,I){return"\n"+I.replace(/^[ ]{0,3}>?[ \t]*$/gm,G)+"\n"})}};if(/^(?![ ]{0,3}>)/m.test(D.selection)){this.wrap(D,o.lineLength-2);D.selection=D.selection.replace(/^/gm,"> ");w(true);D.skipLines()}else{D.selection=D.selection.replace(/^[ ]{0,3}> ?/gm,"");this.unwrap(D);w(false);if(!/^(\n|^)[ ]{0,3}>/.test(D.selection)&&D.startTag){D.startTag=D.startTag.replace(/\n{0,2}$/,"\n\n")}if(!/(\n|^)[ ]{0,3}>.*$/.test(D.selection)&&D.endTag){D.endTag=D.endTag.replace(/^\n{0,2}/,"\n\n")}}D.selection=this.hooks.postBlockquoteCreation(D.selection);if(!/\n/.test(D.selection)){D.selection=D.selection.replace(/^(> *)/,function(G,H){D.startTag+=H;return""})}};f.doCode=function(w,x){var z=/\S[ ]*$/.test(w.before);var B=/^[ ]*\S/.test(w.after);if((!B&&!z)||/\n/.test(w.selection)){w.before=w.before.replace(/[ ]{4}$/,function(C){w.selection=C+w.selection;return""});var A=1;var y=1;if(/(\n|^)(\t|[ ]{4,}).*\n$/.test(w.before)){A=0}if(/^\n(\t|[ ]{4,})/.test(w.after)){y=0}w.skipLines(A,y);if(!w.selection){w.startTag="    ";w.selection="enter code here"}else{if(/^[ ]{0,3}\S/m.test(w.selection)){if(/\n/.test(w.selection)){w.selection=w.selection.replace(/^/gm,"    ")}else{w.before+="    "}}else{w.selection=w.selection.replace(/^[ ]{4}/gm,"")}}}else{w.trimWhitespace();w.findTags(/`/,/`/);if(!w.startTag&&!w.endTag){w.startTag=w.endTag="`";if(!w.selection){w.selection="enter code here"}}else{if(w.endTag&&!w.startTag){w.before+=w.endTag;w.endTag=""}else{w.startTag=w.endTag=""}}}};f.doList=function(H,A,z){var J=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/;var I=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/;var w="-";var E=1;var C=function(){var K;if(z){K=" "+E+". ";E++}else{K=" "+w+" "}return K};var D=function(K){if(z===undefined){z=/^\s*\d/.test(K)}K=K.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(L){return C()});return K};H.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null);if(H.before&&!/\n$/.test(H.before)&&!/^\n/.test(H.startTag)){H.before+=H.startTag;H.startTag=""}if(H.startTag){var y=/\d+[.]/.test(H.startTag);H.startTag="";H.selection=H.selection.replace(/\n[ ]{4}/g,"\n");this.unwrap(H);H.skipLines();if(y){H.after=H.after.replace(I,D)}if(z==y){return}}var B=1;H.before=H.before.replace(J,function(K){if(/^\s*([*+-])/.test(K)){w=m.$1}B=/[^\n]\n\n[^\n]/.test(K)?1:0;return D(K)});if(!H.selection){H.selection="List item"}var F=C();var x=1;H.after=H.after.replace(I,function(K){x=/[^\n]\n\n[^\n]/.test(K)?1:0;return D(K)});H.trimWhitespace(true);H.skipLines(B,x,true);H.startTag=F;var G=F.replace(/./g," ");this.wrap(H,o.lineLength-G.length);H.selection=H.selection.replace(/\n/g,"\n"+G)};f.doHeading=function(y,z){y.selection=y.selection.replace(/\s+/g," ");y.selection=y.selection.replace(/(^\s+|\s+$)/g,"");if(!y.selection){y.startTag="## ";y.selection="Heading";y.endTag=" ##";return}var A=0;y.findTags(/#+[ ]*/,/[ ]*#+/);if(/#+/.test(y.startTag)){A=m.lastMatch.length}y.startTag=y.endTag="";y.findTags(null,/\s?(-+|=+)/);if(/=+/.test(y.endTag)){A=1}if(/-+/.test(y.endTag)){A=2}y.startTag=y.endTag="";y.skipLines(1,1);var B=A==0?2:A-1;if(B>0){var x=B>=2?"-":"=";var w=y.selection.length;if(w>o.lineLength){w=o.lineLength}y.endTag="\n";while(w--){y.endTag+=x}}};f.doHorizontalRule=function(w,x){w.startTag="----------\n";w.selection="";w.skipLines(2,1,true)};Markdown.Editor.getDefaultButtons=function(){var w={bold:{id:"wmd-bold-button",title:"Strong <strong> Ctrl+B",icon:"icon-bold"},italic:{id:"wmd-italic-button",title:"Emphasis <em> Ctrl+I",icon:"icon-italic"},link:{id:"wmd-link-button",title:"Hyperlink <a> Ctrl+L",icon:"icon-link"},quote:{id:"wmd-quote-button",title:"Blockquote <blockquote> Ctrl+Q",icon:"icon-blockquote"},code:{id:"wmd-code-button",title:"Code Sample <pre><code> Ctrl+K",icon:"icon-code"},image:{id:"wmd-image-button",title:"Image <img> Ctrl+G",icon:"icon-picture"},olist:{id:"wmd-olist-button",title:"Numbered List <ol> Ctrl+O",icon:"icon-list"},ulist:{id:"wmd-ulist-button",title:"Bulleted List <ul> Ctrl+U",icon:"icon-bullet-list"},heading:{id:"wmd-heading-button",title:"Heading <h1>/<h2> Ctrl+H",icon:"icon-header"},hr:{id:"wmd-hr-button",title:"Horizontal Rule <hr> Ctrl+R",icon:"icon-hr-line"},undo:{id:"wmd-undo-button",title:"Undo - Ctrl+Z",icon:"icon-undo"},redo:{id:"wmd-redo-button",title:/win/.test(g.platform.toLowerCase())?"Redo - Ctrl+Y":"Redo - Ctrl+Shift+Z",icon:"icon-share-alt"}};return w};Markdown.Editor.getDefaultHelpButton=function(){var w={id:"wmd-help-button",title:j,isHelp:true};return w};Markdown.Editor.MakeHelpButton=function(w,x){button=Markdown.Editor.getDefaultHelpButton();if(w){button.handler=w}if(x){button.title=x}return button}})();