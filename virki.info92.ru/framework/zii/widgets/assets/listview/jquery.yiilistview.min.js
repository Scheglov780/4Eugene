(function(b){var a={};b.fn.yiiListView=function(c){return this.each(function(){var d=b.extend({},b.fn.yiiListView.defaults,c||{}),e=b(this),f=e.attr("id");if(d.updateSelector==undefined){d.updateSelector="#"+f+" ."+d.pagerClass.replace(/\s+/g,".")+" a, #"+f+" ."+d.sorterClass.replace(/\s+/g,".")+" a"}b.fn.yiiListView.settings[f]=d;if(d.ajaxUpdate.length>0){b(document).off("click.yiiListView",d.updateSelector).on("click.yiiListView",d.updateSelector,function(){if(d.enableHistory&&window.History.enabled){var g=b(this).attr("href");if(g){var h=g.split("?"),j=b.deparam.querystring("?"+(h[1]||""));delete j[d.ajaxVar];var i=b.param.querystring(h[0],j);window.History.pushState({url:i},document.title,i)}}else{b.fn.yiiListView.update(f,{url:b(this).attr("href")})}return false});if(d.enableHistory&&window.History.enabled){b(window).bind("statechange",function(){var g=window.History.getState();if(g.data.url===undefined){g.data.url=g.url}b.fn.yiiListView.update(f,g.data)})}}})};b.fn.yiiListView.defaults={ajaxUpdate:[],ajaxVar:"ajax",ajaxType:"GET",pagerClass:"pager",loadingClass:"loading",sorterClass:"sorter"};b.fn.yiiListView.settings={};b.fn.yiiListView.getKey=function(d,c){return b("#"+d+" > div.keys > span:eq("+c+")").text()};b.fn.yiiListView.getUrl=function(d){var c=b.fn.yiiListView.settings[d];return c.url||b("#"+d+" > div.keys").attr("title")};b.fn.yiiListView.update=function(f,d){var c,e=b.fn.yiiListView.settings[f];if(d&&d.error!==undefined){c=d.error;delete d.error}d=b.extend({type:e.ajaxType,url:b.fn.yiiListView.getUrl(f),success:function(h,g){b.each(e.ajaxUpdate,function(k,j){var l="#"+j;b(l).replaceWith(b(l,"<div>"+h+"</div>"))});if(e.afterAjaxUpdate!=undefined){e.afterAjaxUpdate(f,h)}},complete:function(){b("#"+f).removeClass(e.loadingClass);a[f]=null},error:function(i,k,j){var g,h;if(i.readyState===0||i.status===0){return}if(c!==undefined){g=c(i);if(g!==undefined&&!g){return}}switch(k){case"timeout":h="The request timed out!";break;case"parsererror":h="Parser error!";break;case"error":if(i.status&&!/^\s*$/.test(i.status)){h="Error "+i.status}else{h="Error"}if(i.responseText&&!/^\s*$/.test(i.responseText)){h=h+": "+i.responseText}break}if(e.ajaxUpdateError!==undefined){e.ajaxUpdateError(i,k,j,h,f)}else{if(h){alert(h)}}}},d||{});if(d.data!=undefined&&d.type=="GET"){d.url=b.param.querystring(d.url,d.data);d.data={}}if(e.ajaxVar){d.url=b.param.querystring(d.url,e.ajaxVar+"="+f)}if(a[f]!=null){a[f].abort()}b("#"+f).addClass(e.loadingClass);if(e.beforeAjaxUpdate!=undefined){e.beforeAjaxUpdate(f,d)}a[f]=b.ajax(d)}})(jQuery);